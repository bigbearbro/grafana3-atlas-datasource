{"version":3,"sources":["../../src/query_ctrl.js"],"names":["AtlasDatasourceQueryCtrl","$scope","$injector","templateSrv","uiSegmentSrv","scope","target","atlas","aggregations","steps","logical","notCondition","matchers","datasource","metricFindQuery","then","transformToSegments","console","log","metricFindDimensions","tag","dimensionFindValues","panelCtrl","refresh","aTarget","rawQueryInput","tags","splice","indexOf","push","name","value","matcher","groupBy","groupBys","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import angular from \"angular\";\nimport _ from \"lodash\";\nimport {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!';\n\nexport class AtlasDatasourceQueryCtrl extends QueryCtrl {\n\n    constructor($scope, $injector, templateSrv, uiSegmentSrv) {\n        super($scope, $injector);\n\n        this.scope = $scope;\n        this.uiSegmentSrv = uiSegmentSrv;\n        this.templateSrv = templateSrv;\n        this.target.target = this.target.target || 'select metric';\n        this.scope.atlas = {};\n        this.scope.atlas.aggregations = [\n            \"sum\",\n            \"avg\",\n            \"count\",\n            \"max\",\n            \"min\",\n            \"cf-avg\",\n            \"cf-max\",\n            \"cf-min\",\n            \"cf-sum\"\n        ];\n        this.scope.atlas.steps = [\n            \"s\",\n            \"m\",\n            \"h\",\n            \"d\"\n        ];\n        this.scope.atlas.logical = [\n            \"and\",\n            \"or\"\n        ];\n        this.scope.atlas.notCondition = [\n            \" \",\n            \"not\"\n        ];\n        this.scope.atlas.matchers = [\n            \"eq\",\n            \"ge\",\n            \"gt\",\n            \"le\",\n            \"lt\",\n            \"has\",\n            \"in\",\n            \"re\",\n            \"reic\"\n        ];\n    }\n\n    getOptions() {\n        return this.datasource.metricFindQuery(this.target)\n            .then(this.uiSegmentSrv.transformToSegments(true));\n        // Options have to be transformed by uiSegmentSrv to be usable by metric-segment-model directive\n    }\n\n    getDimensionsForMetric() {\n      if (this.target.target) {\n        console.log(\"have a target, getting applicable dimensions\");\n\n        return this.datasource.metricFindDimensions(this.target)\n          .then(this.uiSegmentSrv.transformToSegments(true));\n      }\n    }\n\n    getDimensionValues(tag) {\n      if (tag) {\n        console.log(\"have a dimension, getting available values\");\n        return this.datasource.dimensionFindValues(this.target,tag)\n          .then(this.uiSegmentSrv.transformToSegments(true));\n      }\n    }\n\n    onChangeInternal() {\n        this.panelCtrl.refresh(); // Asks the panel to refresh data.\n    }\n\n    toggleRawQuery(aTarget) {\n        aTarget.rawQueryInput = !aTarget.rawQueryInput;\n        this.panelCtrl.refresh();\n    }\n\n    removeTag(tag) {\n        if (this.target.tags) {\n            this.target.tags.splice(this.target.tags.indexOf(tag), 1);\n            this.panelCtrl.refresh();\n        }\n    }\n\n    addTag() {\n        if (!this.target.tags) {\n            this.target.tags = [];\n        }\n        this.target.tags.push({\n            name: null,\n            value: null,\n            notCondition: this.scope.atlas.notCondition[0],\n            logical: this.scope.atlas.logical[0],\n            matcher: this.scope.atlas.matchers[0]\n        });\n    }\n\n    removeGroupBy(groupBy) {\n        if (this.target.groupBys) {\n            this.target.groupBys.splice(this.target.groupBys.indexOf(groupBy), 1);\n        }\n    }\n\n    addGroupBy() {\n        if (!this.target.groupBys) {\n            this.target.groupBys = [];\n        }\n        this.target.groupBys.push({});\n    }\n}\n\nAtlasDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}